@model DrivePal.Models.User

@{
    ViewData["Title"] = "Edit Profile";
    var isInstructor = Model is DrivePal.Models.Instructor;
    var instructor = Model as DrivePal.Models.Instructor;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <link rel="stylesheet" href="style.css">
    <script>
        function displayDefaultPicture() {
            var input = document.getElementById('profilePicture');
            var img = document.querySelector('.profile-picture');
            if (!input.files || !input.files[0]) {
                img.src = "/img/profilepictures/defaultprofile.png";
            }
            else {
                var reader = new FileReader();
                reader.onload = function (e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</head>
<body>

    <div class="profile-container">
        <div>
            <img class="profile-picture" src="@ViewBag.ProfilePicture" alt="Profile Picture">
        </div>
        <div class="profile-details">
            <h2 style="text-align:center">Edit Profile</h2>
            <form method="post" action="/Home/SaveProfileChanges" enctype="multipart/form-data">
                <table>
                    <tr>
                        <td><label for="profilePicture">Profile Picture:</label></td>
                        <td>
                            <input type="file" id="profilePicture" name="profilePicture" accept="image/*" onchange="displayDefaultPicture()">
                        </td>
                    </tr>
                    <!-- Non-editable fields as display-only -->
                    <tr>
                        <td>Email:</td>
                        <td><input type="text" id="email" name="email" value="@Model.Email" readonly></td>
                    </tr>
                    <tr>
                        <td>First Name:</td>
                        <td><input type="text" id="firstName" name="firstName" value="@Model.FirstName" readonly></td>
                    </tr>
                    <tr>
                        <td>Last Name:</td>
                        <td><input type="text" id="lastName" name="lastName" value="@Model.LastName" readonly></td>
                    </tr>
                    <tr>
                        <td>Date of Birth:</td>
                        <td><input type="text" id="dob" name="dob" value="@Model.DOB.ToString("yyyy-MM-dd")" readonly></td>
                    </tr>
                    <tr>
                        <td>Gender:</td>
                        <td>
                            <input type="text" id="gender" name="gender" value="@Model.Gender.ToString()" readonly>
                        </td>
                    </tr>
                    <!-- Editable fields -->
                    <tr>
                        <td>Street:</td>
                        <td><input type="text" id="street" name="street" value="@Model.Street"></td>
                    </tr>
                    <tr>
                        <td>City:</td>
                        <td><input type="text" id="city" name="city" value="@Model.City"></td>
                    </tr>
                    <tr>
                        <td>Post Code:</td>
                        <td><input type="text" id="postCode" name="postCode" value="@Model.PostCode"></td>
                    </tr>
                    <!-- Add editable phone number field as required -->
                    <!-- Phone Number with validation -->
                    <tr>
                        <td><label for="phoneNumber">Phone Number:</label></td>
                        <td>
                            <input type="tel" id="phoneNumber" name="phoneNumber" value="@Model.PhoneNumber"
                                   required
                                   maxlength="13"
                                   pattern="^\+447\d{9}$"
                                   title="The Phone Number must start with +44 and contain only numbers and must be exactly 13 characters."
                                   class="form-control" /> <!-- Add your existing classes if necessary -->
                        </td>
                    </tr>

                    @if (isInstructor)
                    {
                        <tr>
                            <td>License Number:</td>
                            <td><input type="text" id="licenseNumber" name="licenseNumber" value="@instructor.LicenceNumber" readonly></td>
                        </tr>
                    }
                </table>

                <button type="submit" class="button">Save Changes</button>
                <a class="button" href="/Home/Profile">Cancel</a>
            </form>
        </div>
    </div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

</body>
</html>
