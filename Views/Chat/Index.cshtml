@model ChatViewModel
@using System.Security.Claims
@using DrivePal.Models
@{
    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .message-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Align messages to the left */
            height: 500px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .input-group {
            flex: none;
        }

        .message-bubble {
            border-radius: 20px;
            padding: 10px 15px;
            margin-bottom: 10px;
            max-width: 70%;
        }

        .message-bubble-sent {
            align-self: flex-end; /* Messages sent by the current user are aligned to the right */
            background-color: #a1dfa7; /* Light green for messages sent by the current user */
        }

        .message-bubble-received {
            align-self: flex-start; /* Messages received by the current user are aligned to the left */
            background-color: #c6c1c1; /* Light grey for messages received */
        }

        .chat-group {
            background-color: #f0f0f0;
            border-radius: 25px;
            padding: 10px;
            margin: 10px 0;
            max-width: 80%;
            clear: both;
        }

        .chat-groups-container {
            display: flex;
            flex-direction: column;
            /* Add other styles as needed */
        }

        .chat-group {
            /* Other styles */
            cursor: pointer; /* Changes the cursor to a hand when hovering over the element */
            transition: background-color 0.3s ease; /* Smooth transition for the background color change */
        }

            .chat-group:hover {
                background-color: #f0f0f0; /* Change the background color when hovering over the element */
            }



    </style>
</head>
<body>
    <div id="chatContainer" data-recipient-id="@Model.RecipientId" data-current-user="@userId" data-current-user-name="@Model.CurrentUserName">
        <h2>@Model.GroupName</h2>
    <div class="container">
    <div class="row">
        <div class="col-6">
            <h4>Recent Conversations</h4>
            <div class="chat-groups-container" id="chatGroupsContainer">
                @foreach (var group in Model.UserGroups)
                {
                    <p>@group.Name</p>
                    var recentMessage = group.Messages.OrderByDescending(m => m.SentAt).FirstOrDefault();
                    if (recentMessage != null)
                    {
                        <p>Last message: @recentMessage.Content</p>
                    }
                }
            </div>  
        </div>
        <div class="col-6">
            <h4>@Model.CurrentUserName</h4>
            <h4>Chatting with @Model.OtherUserName</h4>
                    <div class="message-container" id="messageContainer">
                        @foreach (var message in Model.Messages)
                        {
                            var senderName = Model.SenderNames.ContainsKey(message.SenderId) ? Model.SenderNames[message.SenderId] : message.SenderId;
                            <div class="@(message.SenderId == userId ? "message-bubble-sent" : "message-bubble-received")">
                                <p><strong>@senderName:</strong> @message.Content</p>
                                <span class="small text-muted">@message.SentAt.ToString("HH:mm")</span>
                            </div>
                        }
                    </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" id="messageInput" class="form-control" placeholder="Type a message...">
                    <div class="input-group-append">
                        <button id="sendButton" class="btn btn-primary">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.7/signalr.min.js"></script>
    <script src="~/js/chat.js"></script>

</body>
</html>